<!DOCTYPE html>
<html>
    <head>
        <title>NVGL Expr - playground</title>
        <meta charset="utf-8">
        <script src="./node_modules/monaco-editor/min/vs/loader.js"></script>
        <meta property="og:title" content="NVGL Expr - playground">
        <meta property="og:description" content="A playground for expression parsing in the language of project files in my video editing software NVG.">
        <meta name="application-name" content="NVGL Expr - playground">
        <meta property="description" content="A playground for expression parsing in the language of project files in my video editing software NVG.">
    </head>
    <body>
        Input
        <div id="input_vars" style="height: 20px"></div>
        <div id="input" style="height: 20px"></div>
        Output
        <div class="output" style="height: 20px"></div>
        <div class="output" style="height: 100px"></div>
        <div class="output" style="height: calc(100dvh - 280px)"></div>
    </body>
</html>
<script>module={}</script>
<script type="module" src="./expr.js"></script>
<script>

window.onload = ()=>{
    if (input_vars.getValue()=="") {input_vars.setValue(`{"a":2,"b":3}`)}
    if (input.getValue()=="") {input.setValue(`(1+a)^b+a^2`)}
};

function update() {
    let i = input.getValue();
    console.log("input: ",i);
    try {
        let vars = JSON.parse(input_vars.getValue());
        console.log(vars);
        vars.Math = Math;
        let parseRet = module.exports.parse(i,{mode:"parse",vars:vars});
        let jsRet = module.exports.parse(i,{mode:"js",vars:vars});
        let evalRet = module.exports.parse(i,{mode:"eval",vars:vars});
        console.log("parse",parseRet)
        console.log("js",jsRet)
        console.log("eval",evalRet)
        console.log(JSON.stringify(evalRet,null,4))
        updateEditorData(parseOut,JSON.stringify(parseRet,null,4)??evalRet.toString());
        updateEditorData(jsOut,jsRet);
        updateEditorData(evalOut,JSON.stringify(evalRet,null,4)??evalRet.toString());
    }
    catch (e) {
        console.error(e);
        updateEditorData(jsOut,e.name)
        updateEditorData(evalOut,e.message)
        updateEditorData(parseOut,JSON.stringify([e.name,e.message,e.location],null,4))
    }
}

function updateEditorData(editor,data) {
    console.log(typeof data)
    editor.setValue(data)
}


require.config({ paths: { vs: "./node_modules/monaco-editor/min/vs" } });

require(["vs/editor/editor.main"], function () {
    input_vars = monaco.editor.create(document.querySelector("#input_vars"),{
        language: "json",
        readOnly: false,
        theme: "vs-dark",
        roundedSelection: true,
        lineNumbers: "off",
        automaticLayout: true,
    });
    input_vars.getModel().onDidChangeContent((e)=>{
        update()
    })
});
require(["vs/editor/editor.main"], function () {
    input = monaco.editor.create(document.querySelector("#input"),{
        readOnly: false,
        theme: "vs-dark",
        roundedSelection: true,
        lineNumbers: "off",
        automaticLayout: true,
    });
    input.getModel().onDidChangeContent((e)=>{
        update()
    })
});
require(["vs/editor/editor.main"], function () {
    jsOut = monaco.editor.create(document.querySelectorAll(".output")[0],{
        language: "javascript",
        readOnly: true,
        theme: "vs-dark",
        roundedSelection: true,
        lineNumbers: "off",
        automaticLayout: true,
    });
});
require(["vs/editor/editor.main"], function () {
    evalOut = monaco.editor.create(document.querySelectorAll(".output")[1],{
        language: "javascript",
        readOnly: true,
        theme: "vs-dark",
        roundedSelection: true,
        lineNumbers: "off",
        automaticLayout: true,
    });
});
require(["vs/editor/editor.main"], function () {
    parseOut = monaco.editor.create(document.querySelectorAll(".output")[2],{
        language: "javascript",
        readOnly: true,
        theme: "vs-dark",
        roundedSelection: true,
        lineNumbers: "on",
        automaticLayout: true,
    });
});
</script>
<style>
:root {
    color-scheme: dark;
    user-select: none;
}

body {
    position: absolute;
    top: 0;
    left: 0;
    padding: 5px;
    padding-left: 10px;
    margin: 0;
    width: calc(100dvw - 15px);
    height: calc(100dvh - 10px);
    overflow: hidden;
    background: rgba(0, 106, 255, 0.137);
}

#input {
    margin: 10px;
    border: 1px solid rgba(255, 255, 255, 0.4);
}

.output {
    margin: 10px;
}

</style>