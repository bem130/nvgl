<!DOCTYPE html>
<html>
    <head>
        <title>NVGL Expr - playground</title>
        <meta charset="utf-8">
        <script src="./node_modules/monaco-editor/min/vs/loader.js"></script>
        <meta property="og:title" content="NVGL Expr - playground">
        <meta property="og:description" content="A playground for expression parsing in the language of project files in my video editing software NVG.">
        <meta name="application-name" content="NVGL Expr - playground">
        <meta property="description" content="A playground for expression parsing in the language of project files in my video editing software NVG.">
    </head>
    <body>
        <input type="text" id="input">
        <div class="output" style="height: 20px"></div>
        <div class="output" style="height: calc(100dvh - 100px)"></div>
    </body>
</html>
<script>module={}</script>
<script type="module" src="./expr.js"></script>
<script>

var input = document.querySelector("#input");
var output1;
var output2;

input.onchange = update;
input.onkeyup = update;
window.onload = ()=>{
    if (input.value=="") {input.value = `(1+3)*3+2+{"a":{"b":5},1:2}::a::b`}
    update();
};

function update() {
    let i = input.value;
    console.log("input: ",i);
    try {
        let ret1 = module.exports.parse(i,{mode:"js"});
        let ret2 = module.exports.parse(i,{mode:"parse"});
        console.log(ret1)
        console.log(ret2)
        updateEditorData(output1,ret1.toString())
        updateEditorData(output2,JSON.stringify(ret2,null,4))
    }
    catch (e) {
        console.error(e);
        updateEditorData(output1,"error")
        updateEditorData(output2,JSON.stringify([e.name,e.message,e.location],null,4))
    }
}

function updateEditorData(editor,data) {
    editor.setValue(data)
}


require.config({ paths: { vs: "./node_modules/monaco-editor/min/vs" } });

require(["vs/editor/editor.main"], function () {
    output1 = monaco.editor.create(document.querySelectorAll(".output")[0],{
        language: "javascript",
        readOnly: true,
        theme: "vs-dark",
        roundedSelection: true,
        lineNumbers: "off",
        automaticLayout: true,
    });
});
require(["vs/editor/editor.main"], function () {
    output2 = monaco.editor.create(document.querySelectorAll(".output")[1],{
        language: "javascript",
        readOnly: true,
        theme: "vs-dark",
        roundedSelection: true,
        lineNumbers: "on",
        automaticLayout: true,
    });
});
</script>
<style>
:root {
    color-scheme: dark;
    user-select: none;
}

#input {
    width: calc(100% - 20px);
}
.output {
    margin: 5px;
}

</style>